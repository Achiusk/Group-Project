@page "/"
@page "/landing"
@using urban_city_power_managment.Web.Services
@inject NavigationManager Navigation
@inject IAuthService AuthService
@inject IJSRuntime JSRuntime
@inject AppStateService AppState
@implements IDisposable

<PageTitle>@(AppState.IsEnglish ? "Eindhoven Energy - Smart Energy Management" : "Eindhoven Energie - Beheer je Energieverbruik Slim")</PageTitle>

@if (!isLoading)
{
<div class="landing-page">
    <!-- Global Settings Bar -->
    <div class="settings-bar">
        <div class="container d-flex justify-content-end align-items-center gap-3 py-2">
            <!-- Dark Mode Toggle -->
            <div class="d-flex align-items-center gap-2">
                <i class="bi bi-sun-fill text-warning"></i>
                <div class="form-check form-switch mb-0">
                    <input class="form-check-input" type="checkbox" id="darkModeToggle" 
                           checked="@AppState.IsDarkMode" @onchange="ToggleDarkMode" />
                </div>
                <i class="bi bi-moon-fill text-light"></i>
            </div>
            <!-- Language Toggle -->
            <div class="btn-group btn-group-sm" role="group">
                <button type="button" class="btn @(!AppState.IsEnglish ? "btn-warning" : "btn-outline-light")" 
                        @onclick="() => SetLanguage(false)">NL</button>
                <button type="button" class="btn @(AppState.IsEnglish ? "btn-warning" : "btn-outline-light")" 
                        @onclick="() => SetLanguage(true)">EN</button>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="row align-items-center min-vh-75">
                <div class="col-lg-6">
                    <h1 class="display-4 fw-bold mb-4">
                        @(AppState.IsEnglish ? "Manage Your Energy" : "Beheer je Energieverbruik") <span class="text-accent">@(AppState.IsEnglish ? "Smartly" : "Slim")</span>
                    </h1>
                    <p class="lead mb-4">
                        @(AppState.IsEnglish 
                            ? "Insight into your electricity and gas with real-time P1 sensor data. Save money and contribute to a more sustainable Eindhoven."
                            : "Inzicht in je stroom en gas met realtime P1-sensor data. Bespaar geld en draag bij aan een duurzamer Eindhoven.")
                    </p>
                    <div class="d-flex gap-3 flex-wrap">
                        <a href="/registreren" class="btn btn-register btn-lg px-4">
                            <i class="bi bi-person-plus me-2"></i>@(AppState.IsEnglish ? "Register Free" : "Gratis Registreren")
                        </a>
                        <a href="/inloggen" class="btn btn-login btn-lg px-4">
                            <i class="bi bi-box-arrow-in-right me-2"></i>@(AppState.IsEnglish ? "Login" : "Inloggen")
                        </a>
                    </div>
                    <div class="mt-4 hero-badges">
                        <small>
                            <i class="bi bi-shield-check me-1"></i> @(AppState.IsEnglish ? "Safe & Reliable" : "Veilig & Betrouwbaar")
                            <span class="mx-2">|</span>
                            <i class="bi bi-lightning me-1"></i> @(AppState.IsEnglish ? "Realtime Data" : "Realtime Data")
                            <span class="mx-2">|</span>
                            <i class="bi bi-graph-up me-1"></i> @(AppState.IsEnglish ? "Smart Insights" : "Slimme Inzichten")
                        </small>
                    </div>
                </div>
                <div class="col-lg-6 d-none d-lg-block">
                    <div class="hero-image text-center">
                        <div class="dashboard-preview">
                            <div class="preview-card">
                                <div class="preview-header">@(AppState.IsEnglish ? "Dashboard Preview" : "Dashboard Preview")</div>
                                <div class="preview-stats">
                                    <div class="stat-item">
                                        <span class="stat-icon"><i class="bi bi-lightning-charge-fill"></i></span>
                                        <span class="stat-value">2.4 kW</span>
                                        <span class="stat-label">@(AppState.IsEnglish ? "Current usage" : "Huidig verbruik")</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-icon"><i class="bi bi-sun-fill"></i></span>
                                        <span class="stat-value">1.8 kW</span>
                                        <span class="stat-label">@(AppState.IsEnglish ? "Solar energy" : "Zonne-energie")</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-icon"><i class="bi bi-piggy-bank-fill"></i></span>
                                        <span class="stat-value">€ 3.45</span>
                                        <span class="stat-label">@(AppState.IsEnglish ? "Saved today" : "Vandaag bespaard")</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features-section py-5">
        <div class="container">
            <h2 class="text-center mb-5">@(AppState.IsEnglish ? "Why Eindhoven Energy?" : "Waarom Eindhoven Energie?")</h2>
            <div class="row g-4">
                <div class="col-md-6 col-lg-3">
                    <div class="feature-card h-100">
                        <div class="feature-icon">
                            <i class="bi bi-speedometer2"></i>
                        </div>
                        <h4>@(AppState.IsEnglish ? "Realtime Monitoring" : "Realtime Monitoring")</h4>
                        <p>@(AppState.IsEnglish 
                            ? "See your energy usage live via your P1 smart meter. Updated every second."
                            : "Zie je energieverbruik live via je P1 slimme meter. Elke seconde up-to-date.")</p>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="feature-card h-100">
                        <div class="feature-icon">
                            <i class="bi bi-bar-chart-line-fill"></i>
                        </div>
                        <h4>@(AppState.IsEnglish ? "Detailed Analytics" : "Uitgebreide Analyses")</h4>
                        <p>@(AppState.IsEnglish 
                            ? "Analyze your usage by hour, day, week or month with clear graphs."
                            : "Analyseer je verbruik per uur, dag, week of maand met overzichtelijke grafieken.")</p>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="feature-card h-100">
                        <div class="feature-icon">
                            <i class="bi bi-lightbulb-fill"></i>
                        </div>
                        <h4>@(AppState.IsEnglish ? "Smart Saving Tips" : "Slimme Bespaartips")</h4>
                        <p>@(AppState.IsEnglish 
                            ? "Receive personalized tips to save energy and reduce your bill."
                            : "Ontvang persoonlijke tips om energie te besparen en je rekening te verlagen.")</p>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="feature-card h-100">
                        <div class="feature-icon">
                            <i class="bi bi-sun-fill"></i>
                        </div>
                        <h4>@(AppState.IsEnglish ? "Solar Panel Tracking" : "Zonnepanelen Tracking")</h4>
                        <p>@(AppState.IsEnglish 
                            ? "Track your solar panel output and see how much you feed back to the grid."
                            : "Volg je zonnepanelen opbrengst en zie hoeveel je teruglevert aan het net.")</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- How It Works Section -->
    <section class="how-it-works-section py-5">
        <div class="container">
            <h2 class="text-center mb-5">@(AppState.IsEnglish ? "How does it work?" : "Hoe werkt het?")</h2>
            <div class="row justify-content-center">
                <div class="col-lg-10">
                    <div class="steps-container">
                        <div class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h5>@(AppState.IsEnglish ? "Register your account" : "Registreer je account")</h5>
                                <p>@(AppState.IsEnglish ? "Create a free account with your email and postal code" : "Maak gratis een account aan met je e-mail en postcode")</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h5>@(AppState.IsEnglish ? "Connect your smart meter" : "Koppel je slimme meter")</h5>
                                <p>@(AppState.IsEnglish ? "Connect your P1 port to our app for realtime data" : "Verbind je P1-poort met onze app voor realtime data")</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h5>@(AppState.IsEnglish ? "View your dashboard" : "Bekijk je dashboard")</h5>
                                <p>@(AppState.IsEnglish ? "Get instant insight into your energy usage and costs" : "Krijg direct inzicht in je energieverbruik en kosten")</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h5>@(AppState.IsEnglish ? "Start saving" : "Start met besparen")</h5>
                                <p>@(AppState.IsEnglish ? "Receive tips and optimize your energy usage" : "Ontvang tips en optimaliseer je energiegebruik")</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="stats-section py-5">
        <div class="container">
            <div class="row text-center g-4">
                <div class="col-6 col-md-3">
                    <div class="stat-box">
                        <div class="stat-number">10.000+</div>
                        <div class="stat-text">@(AppState.IsEnglish ? "Households" : "Huishoudens")</div>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="stat-box">
                        <div class="stat-number">15%</div>
                        <div class="stat-text">@(AppState.IsEnglish ? "Avg. Savings" : "Gem. Besparing")</div>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="stat-box">
                        <div class="stat-number">8</div>
                        <div class="stat-text">@(AppState.IsEnglish ? "Districts in Eindhoven" : "Wijken in Eindhoven")</div>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="stat-box">
                        <div class="stat-number">24/7</div>
                        <div class="stat-text">@(AppState.IsEnglish ? "Monitoring" : "Monitoring")</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta-section py-5">
        <div class="container text-center">
            <h2 class="mb-4">@(AppState.IsEnglish ? "Ready to get started?" : "Klaar om te beginnen?")</h2>
            <p class="lead mb-4">@(AppState.IsEnglish 
                ? "Start smart energy management today and save immediately on your energy bill."
                : "Start vandaag nog met slim energiebeheer en bespaar direct op je energierekening.")</p>
            <a href="/registreren" class="btn btn-cta btn-lg px-5">
                <i class="bi bi-rocket-takeoff me-2"></i>@(AppState.IsEnglish ? "Start Free" : "Start Gratis")
            </a>
        </div>
    </section>

    <!-- Footer -->
    <footer class="landing-footer py-4">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                    <span>© 2026 Eindhoven Energie - Smart City Initiative</span>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <a href="/privacy" class="me-3">Privacy</a>
                    <a href="#" class="me-3">@(AppState.IsEnglish ? "Terms" : "Voorwaarden")</a>
                    <a href="/contact">Contact</a>
                </div>
            </div>
        </div>
    </footer>
</div>
}

<style>
    /* ==========================================
       LIGHT MODE (DEFAULT)
       ========================================== */
    .landing-page {
        --primary-blue: #154273;
        --secondary-blue: #01689b;
        --accent-color: #ffb612;
        --bg-dark: #0d1117;
        --bg-section: #f8f9fa;
        --bg-card: #ffffff;
        --text-primary: #154273;
        --text-secondary: #6c757d;
        --text-light: #ffffff;
        --border-color: #dee2e6;
    }

    .settings-bar {
        background: var(--primary-blue);
        border-bottom: 1px solid rgba(255,255,255,0.1);
        position: relative;
        z-index: 100;
    }

    .settings-bar .form-check-input {
        cursor: pointer;
    }

    .settings-bar .form-check-input:checked {
        background-color: var(--accent-color);
        border-color: var(--accent-color);
    }

    .hero-section {
        background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
        color: white;
        padding: 4rem 0;
        min-height: 80vh;
        display: flex;
        align-items: center;
    }

    .text-accent {
        color: var(--accent-color);
    }

    .min-vh-75 {
        min-height: 75vh;
    }

    .hero-badges {
        color: rgba(255,255,255,0.75);
    }

    .btn-register {
        background-color: var(--accent-color);
        border-color: var(--accent-color);
        color: #000;
    }

    .btn-register:hover {
        background-color: #e5a410;
        border-color: #e5a410;
        color: #000;
    }

    .btn-login {
        background: transparent;
        border: 2px solid rgba(255,255,255,0.8);
        color: white;
    }

    .btn-login:hover {
        background: rgba(255,255,255,0.1);
        border-color: white;
        color: white;
    }

    /* Dashboard Preview */
    .dashboard-preview {
        perspective: 1000px;
    }

    .preview-card {
        background: var(--bg-card);
        border-radius: 16px;
        padding: 1.5rem;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        transform: rotateY(-5deg) rotateX(5deg);
        transition: transform 0.3s ease;
    }

    .preview-card:hover {
        transform: rotateY(0) rotateX(0);
    }

    .preview-header {
        color: var(--text-primary);
        font-weight: 600;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--accent-color);
    }

    .preview-stats {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .stat-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.75rem;
        background: var(--bg-section);
        border-radius: 8px;
    }

    .stat-icon {
        font-size: 1.5rem;
        color: var(--accent-color);
    }

    .stat-value {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--text-primary);
    }

    .stat-label {
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-left: auto;
    }

    /* Features Section */
    .features-section {
        background: var(--bg-section);
    }

    .features-section h2 {
        color: var(--text-primary);
    }

    .feature-card {
        background: var(--bg-card);
        border-radius: 12px;
        padding: 2rem;
        text-align: center;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .feature-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .feature-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        color: var(--secondary-blue);
    }

    .feature-card h4 {
        color: var(--text-primary);
        margin-bottom: 0.75rem;
    }

    .feature-card p {
        color: var(--text-secondary);
        margin-bottom: 0;
    }

    /* How It Works */
    .how-it-works-section {
        background: var(--bg-card);
    }

    .how-it-works-section h2 {
        color: var(--text-primary);
    }

    .steps-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        gap: 2rem;
    }

    .step {
        flex: 1;
        min-width: 200px;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .step-number {
        width: 50px;
        height: 50px;
        background: var(--primary-blue);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 1rem;
    }

    .step-content h5 {
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }

    .step-content p {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    /* Stats Section */
    .stats-section {
        background: var(--primary-blue);
        color: white;
    }

    .stat-box {
        padding: 1.5rem;
    }

    .stat-number {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--accent-color);
    }

    .stat-text {
        font-size: 1rem;
        opacity: 0.9;
    }

    /* CTA Section */
    .cta-section {
        background: var(--bg-section);
    }

    .cta-section h2 {
        color: var(--text-primary);
    }

    .cta-section p {
        color: var(--text-secondary);
    }

    .btn-cta {
        background-color: var(--accent-color);
        border-color: var(--accent-color);
        color: #000;
    }

    .btn-cta:hover {
        background-color: #e5a410;
        border-color: #e5a410;
        color: #000;
    }

    /* Footer */
    .landing-footer {
        background: #e9ecef;
        border-top: 1px solid var(--border-color);
        color: var(--text-secondary);
    }

    .landing-footer a {
        color: var(--text-secondary);
        text-decoration: none;
    }

    .landing-footer a:hover {
        text-decoration: underline;
        color: var(--text-primary);
    }

    /* ==========================================
       DARK MODE STYLES
       ========================================== */
    [data-theme="dark"] .landing-page,
    :global([data-theme="dark"]) .landing-page {
        --bg-dark: #0d1117;
        --bg-section: #161b22;
        --bg-card: #1c2128;
        --text-primary: #4ade80;
        --text-secondary: #6ee7b7;
        --text-light: #ffffff;
        --border-color: #30363d;
        --accent-color: #4ade80;
    }

    [data-theme="dark"] .settings-bar,
    :global([data-theme="dark"]) .settings-bar {
        background: #0d1117 !important;
        border-bottom-color: #30363d !important;
    }

    [data-theme="dark"] .hero-section,
    :global([data-theme="dark"]) .hero-section {
        background: linear-gradient(135deg, #0d1117 0%, #161b22 100%) !important;
    }

    [data-theme="dark"] .text-accent,
    :global([data-theme="dark"]) .text-accent {
        color: #4ade80 !important;
    }

    [data-theme="dark"] .btn-register,
    :global([data-theme="dark"]) .btn-register {
        background-color: #22c55e !important;
        border-color: #22c55e !important;
        color: #0d1117 !important;
    }

    [data-theme="dark"] .btn-register:hover,
    :global([data-theme="dark"]) .btn-register:hover {
        background-color: #16a34a !important;
        border-color: #16a34a !important;
    }

    [data-theme="dark"] .btn-login,
    :global([data-theme="dark"]) .btn-login {
        border-color: #4ade80 !important;
        color: #4ade80 !important;
    }

    [data-theme="dark"] .btn-login:hover,
    :global([data-theme="dark"]) .btn-login:hover {
        background: rgba(34, 197, 94, 0.1) !important;
        color: #4ade80 !important;
    }

    [data-theme="dark"] .preview-card,
    :global([data-theme="dark"]) .preview-card {
        background: #1c2128 !important;
    }

    [data-theme="dark"] .preview-header,
    :global([data-theme="dark"]) .preview-header {
        color: #4ade80 !important;
        border-bottom-color: #4ade80 !important;
    }

    [data-theme="dark"] .stat-item,
    :global([data-theme="dark"]) .stat-item {
        background: #161b22 !important;
    }

    [data-theme="dark"] .stat-icon,
    :global([data-theme="dark"]) .stat-icon {
        color: #4ade80 !important;
    }

    [data-theme="dark"] .stat-value,
    :global([data-theme="dark"]) .stat-value {
        color: #4ade80 !important;
    }

    [data-theme="dark"] .stat-label,
    :global([data-theme="dark"]) .stat-label {
        color: #6ee7b7 !important;
    }

    [data-theme="dark"] .features-section,
    :global([data-theme="dark"]) .features-section {
        background: #0d1117 !important;
    }

    [data-theme="dark"] .features-section h2,
    :global([data-theme="dark"]) .features-section h2 {
        color: #4ade80 !important;
    }

    [data-theme="dark"] .feature-card,
    :global([data-theme="dark"]) .feature-card {
        background: #161b22 !important;
        border: 1px solid #30363d !important;
    }

    [data-theme="dark"] .feature-card:hover,
    :global([data-theme="dark"]) .feature-card:hover {
        background: #1c2128 !important;
    }

    [data-theme="dark"] .feature-icon,
    :global([data-theme="dark"]) .feature-icon {
        color: #4ade80 !important;
    }

    [data-theme="dark"] .feature-card h4,
    :global([data-theme="dark"]) .feature-card h4 {
        color: #4ade80 !important;
    }

    [data-theme="dark"] .feature-card p,
    :global([data-theme="dark"]) .feature-card p {
        color: #6ee7b7 !important;
    }

    [data-theme="dark"] .how-it-works-section,
    :global([data-theme="dark"]) .how-it-works-section {
        background: #161b22 !important;
    }

    [data-theme="dark"] .how-it-works-section h2,
    :global([data-theme="dark"]) .how-it-works-section h2 {
        color: #4ade80 !important;
    }

    [data-theme="dark"] .step-number,
    :global([data-theme="dark"]) .step-number {
        background: #22c55e !important;
        color: #0d1117 !important;
    }

    [data-theme="dark"] .step-content h5,
    :global([data-theme="dark"]) .step-content h5 {
        color: #4ade80 !important;
    }

    [data-theme="dark"] .step-content p,
    :global([data-theme="dark"]) .step-content p {
        color: #6ee7b7 !important;
    }

    [data-theme="dark"] .stats-section,
    :global([data-theme="dark"]) .stats-section {
        background: #0d1117 !important;
    }

    [data-theme="dark"] .stat-number,
    :global([data-theme="dark"]) .stat-number {
        color: #4ade80 !important;
    }

    [data-theme="dark"] .stat-text,
    :global([data-theme="dark"]) .stat-text {
        color: #6ee7b7 !important;
    }

    [data-theme="dark"] .cta-section,
    :global([data-theme="dark"]) .cta-section {
        background: #161b22 !important;
    }

    [data-theme="dark"] .cta-section h2,
    :global([data-theme="dark"]) .cta-section h2 {
        color: #4ade80 !important;
    }

    [data-theme="dark"] .cta-section p,
    :global([data-theme="dark"]) .cta-section p {
        color: #6ee7b7 !important;
    }

    [data-theme="dark"] .btn-cta,
    :global([data-theme="dark"]) .btn-cta {
        background-color: #22c55e !important;
        border-color: #22c55e !important;
        color: #0d1117 !important;
    }

    [data-theme="dark"] .btn-cta:hover,
    :global([data-theme="dark"]) .btn-cta:hover {
        background-color: #16a34a !important;
        border-color: #16a34a !important;
    }

    [data-theme="dark"] .landing-footer,
    :global([data-theme="dark"]) .landing-footer {
        background: #0d1117 !important;
        border-top-color: #30363d !important;
        color: #6ee7b7 !important;
    }

    [data-theme="dark"] .landing-footer a,
    :global([data-theme="dark"]) .landing-footer a {
        color: #4ade80 !important;
    }

    [data-theme="dark"] .landing-footer a:hover,
    :global([data-theme="dark"]) .landing-footer a:hover {
        color: #86efac !important;
    }

    [data-theme="dark"] .hero-badges,
    :global([data-theme="dark"]) .hero-badges {
        color: #6ee7b7 !important;
    }

    /* Responsive adjustments */
    @@media (max-width: 768px) {
        .settings-bar .container {
            justify-content: center !important;
        }
    }
</style>

@code {
    private bool isLoading = true;

    protected override void OnInitialized()
    {
        AppState.OnChange += StateHasChanged;
    }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            if (await AuthService.IsAuthenticatedAsync())
            {
                Navigation.NavigateTo("/dashboard", forceLoad: false);
                return;
            }
        }
        catch
        {
            // Auth check failed, show landing page
        }
        
        isLoading = false;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            try
            {
                // Load saved preferences from localStorage
                var themeSaved = await JSRuntime.InvokeAsync<string>("localStorage.getItem", "theme");
                var languageSaved = await JSRuntime.InvokeAsync<string>("localStorage.getItem", "language");

                AppState.IsDarkMode = themeSaved == "dark";
                AppState.IsEnglish = languageSaved == "en";

                // Apply theme globally
                await ApplyGlobalTheme();

                StateHasChanged();
            }
            catch
            {
                // localStorage not available, use defaults
            }
        }
    }

    private async Task ToggleDarkMode(ChangeEventArgs e)
    {
        AppState.IsDarkMode = (bool)(e.Value ?? false);
        try
        {
            await JSRuntime.InvokeVoidAsync("localStorage.setItem", "theme", AppState.IsDarkMode ? "dark" : "light");
            await ApplyGlobalTheme();
        }
        catch { }
    }

    private async Task SetLanguage(bool english)
    {
        AppState.IsEnglish = english;
        try
        {
            await JSRuntime.InvokeVoidAsync("localStorage.setItem", "language", AppState.IsEnglish ? "en" : "nl");
        }
        catch { }
    }

    private async Task ApplyGlobalTheme()
    {
        try
        {
            var theme = AppState.IsDarkMode ? "dark" : "light";
            await JSRuntime.InvokeVoidAsync("eval", $"document.documentElement.setAttribute('data-theme', '{theme}')");
        }
        catch { }
    }

    public void Dispose()
    {
        AppState.OnChange -= StateHasChanged;
    }
}
